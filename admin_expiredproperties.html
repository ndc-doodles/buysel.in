
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - Cybexel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./static/css/admin.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

</head>
<body class="bg-white text-[#151a37] font-sans">

  <div class="flex min-h-screen">



    <aside class="w-64 bg-[#8bc83f] text-white p-6 fixed h-screen overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-transparent">
      <div class="flex items-center justify-center mb-8 bg-white">
        <img src="./static/images/logo.png" alt="Logo" class="w-32 h-32 object-contain">
      </div>
      <nav>
        <ul class="space-y-4 text-sm">
           <li>
            <a href="admin_dashboard.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
              Dashboard
            </a>
          </li>
          <li>
            <a href="admin_categories.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
              Categories
            </a>
          </li>
          <li>
            <a href="admin_propertylistings.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
             Property Listings
            </a>
          </li>
          <li>
            <a href="admin_agentsregisterations.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
             Agents Registerations
            </a>
          </li>
          <li>
            <a href="admin_propertyregisterations.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
             Property Registerations
            </a>
          </li>
          <li>
            <a href="admin_requestform.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
             Agent request form
            </a>
          </li>

          <li>
            <a href="admin_requestform.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
             Agent request form
            </a>
          </li>
          <li>
            <a href="admin_agentlogin.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
             Agent Login
            </a>
          </li>
          <li>
            <a href="admin_premiumagents.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
             Premium Agents
            </a> 
          </li>
          <li>
            <a href="admin_agents.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
             Agents
            </a> 
          </li>

          <li>
            <a href="admin_expiredproperties.html" class="block py-2 px-4 rounded bg-white text-[#151a37]">
             Expired Properties
            </a>
          </li>



          <li>
            <a href="admin_expiredagents.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
             Expired Agents
            </a>
          </li>

          
         <li>
            <a href="admin_blogs.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
              Blogs
            </a>
          </li>
          <li>
            <a href="admin_messagebox.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
              Message box
            </a>
          </li>
          <li>
            <a href="admin_contact.html" class="block py-2 px-4 rounded hover:bg-white hover:text-[#151a37]">
              Contact Form
            </a>
          </li>
          
          
          <li>
  <a href="{% url 'logout' %}" class="block py-2 px-4 rounded bg-[red] text-white">
    Logout
  </a>
</li>

        </ul>
      </nav>
    </aside>


      <main class="ml-64 p-6 w-full">
            <h1 class="text-3xl font-bold mb-6">Expired Properties</h1>



  <button onclick="exportTableToCSV('expiredpropertiesTable', 'properties.csv')" 
          class="mt-4 bg-green-600 text-white px-4 py-2 rounded">
    Export Properties
  </button>
<div class="w-[80%] overflow-x-auto bg-white rounded shadow mt-10">
  <table id="expiredpropertiesTable"  class="w-full text-sm text-left">
    <thead class="bg-black text-white">
      <tr>
        <th class="px-4 py-2">Img</th>       
        <th class="px-4 py-2">Category</th>
        <th class="px-4 py-2">Purpose</th>
        <th class="px-4 py-2">Label</th>
        <th class="px-4 py-2">Area</th>
        <th class="px-4 py-2">Sq. Ft</th>
        <th class="px-4 py-2">Description</th>
        <th class="px-4 py-2">Amenities</th> 
        <th class="px-4 py-2">Map Location</th>   
        <th class="px-4 py-2">Landmark</th>           
        <th class="px-4 py-2">City</th>
        <th class="px-4 py-2">District</th>
        <th class="px-4 py-2">Price</th>
        <th class="px-4 py-2">Total Price</th>
        <th class="px-4 py-2">Owner</th>
        <th class="px-4 py-2">Phone Number</th>
        <th class="px-4 py-2">Whatsapp Number</th>
        <th class="px-4 py-2">Paid</th>
        <th class="px-4 py-2">Added By</th>
        <th class="px-4 py-2">Duration</th>        
        <th class="px-4 py-2">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr class="border-t">
        <td class="px-4 py-2">
          <img src="./static/images/about1.png" alt="House" class="w-16 h-16 object-cover rounded">
        </td>
        <td class="px-4 py-2">House</td>
        <td class="px-4 py-2">Sale</td>
        <td class="px-4 py-2">sale</td>
        <td class="px-4 py-2">1500 sq.ft</td>
        <td class="px-4 py-2">1500</td>
<td class="px-4 py-2">
  <span id="cell-2" class="truncate max-w-[150px] inline-block align-middle">
    VDJFHJDSFBJSDBFJSDFJDSJSHJHDKSkgsdsakdghhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh
  </span>
  <button onclick="openModal('cell-2')" 
          class="text-blue-500 underline ml-2">
    Read more
  </button>
</td>

<div id="textModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-lg max-w-lg w-full max-h-[80vh] overflow-y-auto overflow-x-hidden p-6 relative">
    <button onclick="closeModal()" class="absolute top-2 right-2 text-gray-500 font-bold text-xl">&times;</button>
    <p id="modalContent" class="whitespace-pre-wrap break-words text-gray-800"></p>
  </div>
</div>



        <td class="px-4 py-2">Pool, Garden</td>
        <td class="px-4 py-2">https://maps.app.goo.gl/cfmyqLY6oWRUwE4w7</td>
        <td class="px-4 py-2">Near Mall</td>
        <td class="px-4 py-2">Panampally</td>
        <td class="px-4 py-2">Ernakulam</td>
        <td class="px-4 py-2">₹80L per Acre</td>
        <td class="px-4 py-2">₹80,00,000</td>
        <td class="px-4 py-2">John Doe</td>
        <td class="px-4 py-2">9876543210</td>
        <td class="px-4 py-2">9876543210</td>
        <td class="px-4 py-2">Yes</td>
        <td class="px-4 py-2">John</td>
        <td class="px-4 py-2">1 year</td>

        <td class="px-4 flex space-x-2 py-8">
          <button onclick="openAdminPropertyEditModal(this)" 
            class="bg-yellow-500 text-white px-3 py-1 rounded">
            Edit
          </button>
          <button class="bg-red-600 text-white px-3 py-1 rounded">Delete</button>
            <button class="bg-blue-600 text-white px-3 py-1 rounded">
    Repost
  </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

      </main>


      </div>

<div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 hidden">
  <div class="bg-white p-6 rounded-lg w-full max-w-4xl shadow-lg max-h-[90vh] overflow-y-auto">
    <h2 class="text-xl font-semibold mb-4">Edit Property</h2>
    <form id="editPropertyForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <div>
        <label class="block font-semibold mb-1">Category</label>
        <select id="editCategory" class="w-full border px-3 py-2 rounded">
          <option value="">-- Select Category --</option>
          <option value="software">Software</option>
          <option value="hardware">Hardware</option>
          <option value="network">Network</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div>
        <label class="block font-semibold mb-1">Purpose</label>
        <select id="editPurpose" class="w-full border px-3 py-2 rounded">
          <option value="">-- Select Purpose --</option>
          <option value="development">Development</option>
          <option value="testing">Testing</option>
          <option value="research">Research</option>
          <option value="maintenance">Maintenance</option>
        </select>
      </div>

      <div>
        <label class="block font-semibold mb-1">Label</label>
        <input type="text" id="editLabel" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">Land Area</label>
        <input type="text" id="editArea" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">Sq. Ft</label>
        <input type="number" id="editSqft" class="w-full border px-3 py-2 rounded" />
      </div>

      <div class="md:col-span-2">
        <label class="block font-semibold mb-1">Description</label>
        <textarea id="editDesc" class="w-full border px-3 py-2 rounded" rows="3"></textarea>
      </div>

      <div class="md:col-span-2">
  <label class="block font-semibold mb-1">Amenities</label>
  <div id="modalEditAmenitiesContainer" class="space-y-2"></div>
  <button type="button" onclick="addAmenityField('', 'modalEditAmenitiesContainer')" class="mt-2 px-4 py-1 bg-blue-500 text-white rounded">+ Add Amenity</button>
</div>


      <div class="md:col-span-2">
        <label class="block font-semibold mb-1">Current Image</label>
        <img id="editImagePreview" src="#" alt="Property Image" class="w-40 h-32 object-cover border rounded mb-2" />
        <input type="file" id="editImage" class="w-full border px-3 py-2 rounded" multiple />
      </div>

      <div>
        <label class="block font-semibold mb-1">Price</label>
        <input type="text" id="editPrice" placeholder="10000 per cent" class="w-full border px-3 py-2 rounded" />
      </div>
      <div>
        <label class="block font-semibold mb-1">Total Price</label>
        <input type="text" id="editTotalPrice" placeholder="100000" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">Owner</label>
        <input type="text" id="editOwner" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">Phone</label>
        <input type="text" id="editPhone" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">Whatsapp Number</label>
        <input type="text" id="editWhatsappNumber" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">Map Location</label>
        <input type="text" id="editLocation" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">City</label>
        <input type="text" id="editCity" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">District</label>
        <input type="text" id="editDistrict" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">PIN Code</label>
        <input type="text" id="editPin" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">Landmark</label>
        <input type="text" id="editLandmark" class="w-full border px-3 py-2 rounded" />
      </div>

      <div>
        <label class="block font-semibold mb-1">Paid</label>
        <select id="editPaid" class="w-full border px-3 py-2 rounded">
          <option>Yes</option>
          <option>No</option>
        </select>
      </div>

      <div>
        <label class="block font-semibold mb-1">Added By</label>
        <input type="text" id="editAddedBy" class="w-full border px-3 py-2 rounded" />
      </div>


      <div>
        <label class="block font-semibold mb-1">Duration</label>
        <input type="text" id="editDuration" class="w-full border px-3 py-2 rounded" />
      </div>

      <div class="md:col-span-2 text-right mt-4">
        <button type="button" onclick="closeAdminPropertyEditModal()" class="bg-gray-400 text-white px-4 py-2 rounded mr-2">Cancel</button>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Save Changes</button>
      </div>

    </form>
  </div>
</div>



      <script>
function openModal(spanId) {
  const content = document.getElementById(spanId).textContent;
  document.getElementById("modalContent").textContent = content;
  document.getElementById("textModal").classList.remove("hidden");
}

function closeModal() {
  document.getElementById("textModal").classList.add("hidden");
}
</script>
<script>
  




// Add Amenity Field (works for any container)
function addAmenityField(value = "", containerId) {
  const container = document.getElementById(containerId);

  const wrapper = document.createElement("div");
  wrapper.className = "flex items-center space-x-2";

  const input = document.createElement("input");
  input.type = "text";
  input.placeholder = "Enter Amenity";
  input.value = value;
  input.className = "w-full border px-3 py-2 rounded";

  const delBtn = document.createElement("button");
  delBtn.type = "button";
  delBtn.innerHTML = "&#10006;";
  delBtn.className = "text-red-500 hover:text-red-700 text-lg font-bold px-2";
  delBtn.onclick = () => wrapper.remove();

  wrapper.appendChild(input);
  wrapper.appendChild(delBtn);

  container.appendChild(wrapper);
}

// Initialize both containers with one empty field
window.onload = () => {
  if (document.getElementById("modalEditAmenitiesContainer").children.length === 0) {
    addAmenityField("", "modalEditAmenitiesContainer");
  }
  if (document.getElementById("formAmenitiesContainer").children.length === 0) {
    addAmenityField("", "formAmenitiesContainer");
  }
};

// Open Modal + Populate Data
function openAdminPropertyEditModal(button) {
  const row = button.closest("tr");
  const cells = row.querySelectorAll("td");

  // Extract values from table row
  const category = cells[1].innerText;
  const purpose = cells[2].innerText;
  const label = cells[3].innerText;
  const area = cells[4].innerText;
  const sqft = cells[5].innerText;
  const desc = cells[6].innerText;
  const amenitiesText = cells[7].innerText;
  const location = cells[8].innerText;
  const landmark = cells[9].innerText;
  const city = cells[10].innerText;
  const district = cells[11].innerText;
  const price = cells[12].innerText;
  const totalPrice = cells[13].innerText;
  const owner = cells[14].innerText;
  const phone = cells[15].innerText;
  const whatsapp = cells[16].innerText;
  const paid = cells[17].innerText;
  const addedBy = cells[18].innerText;

  // Fill modal inputs
  document.getElementById("editCategory").value = category;
  document.getElementById("editPurpose").value = purpose;
  document.getElementById("editLabel").value = label;
  document.getElementById("editArea").value = area;
  document.getElementById("editSqft").value = sqft;
  document.getElementById("editDesc").value = desc;
  document.getElementById("editLocation").value = location;
  document.getElementById("editLandmark").value = landmark;
  document.getElementById("editCity").value = city;
  document.getElementById("editDistrict").value = district;
  document.getElementById("editPrice").value = price;
  document.getElementById("editTotalPrice").value = totalPrice;
  document.getElementById("editOwner").value = owner;
  document.getElementById("editPhone").value = phone;
  document.getElementById("editWhatsappNumber").value = whatsapp;
  document.getElementById("editPaid").value = paid;
  document.getElementById("editAddedBy").value = addedBy;

  // Populate amenities
  const container = document.getElementById("modalEditAmenitiesContainer");
  container.innerHTML = ""; // clear previous
  if (amenitiesText.trim() !== "") {
    amenitiesText.split(",").forEach(a => {
      if(a.trim() !== "") addAmenityField(a.trim(), "modalEditAmenitiesContainer");
    });
  } else {
    addAmenityField("", "modalEditAmenitiesContainer"); // at least one field
  }

  // Show modal
  document.getElementById("editModal").classList.remove("hidden");
}

// Close Modal
function closeAdminPropertyEditModal() {
  document.getElementById("editModal").classList.add("hidden");
}

// Initialize modal with one amenity field
window.onload = () => {
  if (document.getElementById("modalEditAmenitiesContainer").children.length === 0) {
    addAmenityField("", "modalEditAmenitiesContainer");
  }
};

</script>



<script>
function downloadCSV(csv, filename) {
  let csvFile = new Blob([csv], { type: "text/csv" });
  let downloadLink = document.createElement("a");
  downloadLink.download = filename;
  downloadLink.href = window.URL.createObjectURL(csvFile);
  downloadLink.style.display = "none";
  document.body.appendChild(downloadLink);
  downloadLink.click();
  document.body.removeChild(downloadLink);
}

function exportTableToCSV(tableId, filename) {
  let csv = [];
  let table = document.getElementById(tableId);
  if (!table) return;

  let rows = table.querySelectorAll("tr");

  for (let i = 0; i < rows.length; i++) {
    let row = [];
    let cols = rows[i].querySelectorAll("td, th");

    for (let j = 0; j < cols.length; j++) {
      // Skip last column (Actions)
      if (j === cols.length - 1) continue;

      // If column contains an image, export src
      let img = cols[j].querySelector("img");
      if (img) {
        row.push('"' + img.src + '"');
        continue;
      }

      // Otherwise, get text only and trim spaces, wrap in quotes
      let text = cols[j].innerText.trim().replace(/\n/g, ' ');
      row.push('"' + text + '"');
    }

    csv.push(row.join(","));
  }

  downloadCSV(csv.join("\n"), filename);
}
</script>
    <script src="./static/js/admin_scripts.js"></script>
  
      </body>
      </html>